<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  File: README
  
    &mdash; Documentation by YARD 0.9.24
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" />

  <link rel="stylesheet" href="css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="file_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: README</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="puppet_class_list_link"
        href="puppet_class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><div id='filecontents'><h1 id="monit">monit</h1>

<h4 id="table-of-contents">Table of Contents</h4>

<ol>
  <li><a href="#label-Description">Description</a></li>
  <li><a href="#label-Setup">Setup - The basics of getting started with monit</a>
    <ul>
      <li><a href="#label-What+monit+affects">What monit affects</a></li>
      <li><a href="#label-Setup+requirements">Setup requirements</a></li>
      <li><a href="#label-Beginning+with+monit">Beginning with monit</a></li>
    </ul>
  </li>
  <li><a href="#label-Usage">Usage - Configuration options and additional functionality</a></li>
  <li><a href="#label-Reference">Reference - An under-the-hood peek at what the module is doing and how</a></li>
  <li><a href="#label-Limitations">Limitations - OS compatibility, etc.</a></li>
  <li><a href="#label-Development">Development - Guide for contributing to the module</a></li>
</ol>

<h2 id="description">Description</h2>

<p>Performs installation and configuration of Monit service, along with fine
grained definition of checks.</p>

<p>All check types provided by Monit are supported. Namely: <code>directory</code>, <code>fifo</code>,
<code>file</code>, <code>filesystem</code>, <code>host</code>, <code>process</code>, <code>program</code>, and <code>system</code>.</p>

<p>In adition to primitive types, a compound check type is provided: <code>service</code>.
It is a set of primitives to check a service’s init script, binary and process.</p>

<h2 id="setup">Setup</h2>

<h3 id="beginning-with-monit">Beginning with monit</h3>

<p><code>include '::monit'</code> is enough to get you up and running. It will configure the basis of monit, with HTTP server listening at <code>localhost:2812</code> and a system check for <code>LOADAVG</code>, <code>CPU</code>, <code>MEMORY</code> and <code>FILESYSTEM</code> at <code>/</code>.</p>

<p>To pass in parameters and override default configuration:</p>

<p><code>puppet
class { '::monit':
  check_interval    =&gt; 60,
  check_start_delay =&gt; 120,
  mailserver        =&gt; 'localhost',
  eventqueue        =&gt; true,
  alerts            =&gt; ['root@localhost', 'sla1@example.com only on { timeout, nonexist }'],
  httpserver        =&gt; true,
  httpserver_allow  =&gt; ['admin:secret'],
}
</code></p>

<h2 id="usage">Usage</h2>

<p>All parameters for the monit module are contained within the main <code>::monit</code>
class, so for any function of the module, set the options you want.
See the common usages below for examples.</p>

<p>Check types are implemented by defined types, named after <code>monit::check::TYPE</code>.
All check types have several configuration options in common (ex: group,
priority, alerts, dependencies, etc.), along with the check specific options.</p>

<p>On the other hand, <code>monit::check</code> defined type is a facade for all check types.
It works as a single entry point to declare any type of check in the same way.
Common configuration options are parameters of the defined type, and check
specific options are passed through a hash in the <code>config</code> parameter.</p>

<p>So there’re several entry points to declare your own checks:</p>

<ul>
  <li>Create an instance of the specific defined type for the given check (ex: <code>monit::check::TYPE</code>)</li>
  <li>Create an instance of the generic <code>monit::check</code> defined type, and pass in the details of the check</li>
  <li>Pass in a hash of checks to <code>::monit</code> class. This enables providing the checks from Hiera, with your preferred merge strategy</li>
</ul>

<h3 id="install-and-enable-monit">Install and enable monit</h3>

<p><code>puppet
include '::monit'
</code></p>

<h3 id="customize-the-system-check">Customize the system check</h3>

<p><code>puppet
class { '::monit':
  system_cpu_wait       =&gt; '40%',
  system_memory         =&gt; '84%',
  system_loadavg_1min   =&gt; 14.0,
  system_fs_space_usage =&gt; '88%',
  system_fs             =&gt; ['/', '/mnt/backups'],
}
</code></p>

<h3 id="declare-a-check-by-instantiating-the-checks-defined-type">Declare a check by instantiating the check’s defined type</h3>

<p>```puppet
include ::monit</p>

<p>monit::check::filesystem { ‘somefs’:
  paths =&gt; [‘/mount/somefs’,],
  tests =&gt; [
    =&gt; ‘fsflags’,
    =&gt; ‘permission’, ‘value’ =&gt; ‘0755’,
    =&gt; ‘space’, ‘operator’ =&gt; ‘&gt;’, ‘value’ =&gt; ‘80%’,
  ]
}
```</p>

<h3 id="declare-a-check-by-instantiating-the-generic-check-defined-type">Declare a check by instantiating the generic check defined type</h3>

<p>```puppet
include ::monit</p>

<h1 id="add-a-check-for-ntp-process">Add a check for ntp process.</h1>
<p>monit::check { ‘ntp’:
  type              =&gt; ‘process’,
  config            =&gt; {
    ‘pidfile’       =&gt; ‘/var/run/ntpd.pid’,
    ‘program_start’ =&gt; ‘/etc/init.d/ntp start’,
    ‘program_stop’  =&gt; ‘/etc/init.d/ntp stop’,
  },
  tests             =&gt; [
    {
      ‘type’     =&gt; ‘connection’,
      ‘host’     =&gt; ‘127.0.0.1’,
      ‘port’     =&gt; ‘123’,
      ‘protocol’ =&gt; ‘ntp’,
      ‘action’   =&gt; ‘restart’,
    },
  ],
}
```</p>

<h3 id="provide-the-monit-class-with-a-check-for-ssh-service">Provide the monit class with a check for ssh service</h3>

<p>```puppet
include ::monit</p>

<p>class { ‘::monit’:
  checks =&gt; {
    ‘sshd’ =&gt; {
      ‘type’    =&gt; ‘service’,
      ‘config’ =&gt; {
        ‘pidfile’       =&gt; ‘/var/run/sshd.pid’,
      },
      ‘tests’  =&gt; [
        {
          ‘type’     =&gt; ‘connection’,
          ‘host’     =&gt; ‘127.0.0.1’,
          ‘port’     =&gt; ‘22’,
          ‘protocol’ =&gt; ‘ssh’,
          ‘action’   =&gt; ‘restart’,
        },
      ],
    },
  }
}
```</p>

<h3 id="provide-full-module-config-and-checks-from-hiera">Provide full module config and checks from Hiera</h3>

<p>```yaml
# Main monitrc configuration options.
monit::check_interval    : ‘60’
monit::check_start_delay : ‘120’
monit::mailserver        : ‘localhost’
monit::eventqueue        : true
monit::alerts            :
  - ‘root@localhost’
  - ‘sla1@example.com only on { timeout, nonexist }’
monit::httpserver        : true
monit::httpserver_allow  :
  - ‘admin:secret’</p>

<h1 id="tweak-system-check">Tweak system check.</h1>
<p>monit::system_fs         : [’/’, ‘/mnt/backups’]</p>

<h1 id="add-some-checks">Add some checks.</h1>
<p>monit::checks :</p>

<p>somefs :
    type     : filesystem
    config   :
      paths  :
        - /
        - /mount/somefs
    tests    :
      - type: fsflags
      - type: permission
        value: ‘0755’
      - type: space
        operator: ‘&gt;’
        value: 80%</p>

<p>sshd :
    type    : process
    config  :
      pidfile       : /var/run/sshd.pid
      program_start : /etc/init.d/sshd start
      program_stop  : /etc/init.d/sshd stop
    tests  :
      - type     : connection
        host     : 127.0.0.1
        port     : 22
        protocol : ssh
        action   : restart</p>

<p>php5-fpm :
    type    : process
    config  :
      pidfile       : /var/run/php5-fpm.pid
      program_start : /etc/init.d/php5-fpm start
      program_stop  : /etc/init.d/php5-fpm stop
    tests  :
      - type          : connection
        host          : 127.0.0.1
        port          : 9000
        socket_type   : TCP
        protocol      : GENERIC
        protocol_test :
          - send   : ‘“\0x01\0x09\0x00\0x00\0x00\0x00\0x08\0x00\0x00\0x00\0x00\0x00\0x00\0x00\0x00\0x00”’
            expect : ‘“\0x01\0x0A”’
        action   : restart</p>

<p>ntp :
    type   : process
    config :
      pidfile       : /var/run/ntpd.pid
      program_start : /etc/init.d/ntpd start
      program_stop  : /etc/init.d/ntpd stop
    tests  :
      - type        : connection
        host        : 127.0.0.1
        socket_type : udp
        port        : 123
        protocol    : ntp
        action      : restart</p>

<p>varnish :
    type   : process
    config :
      pidfile       : /var/run/varnish.pid
      program_start : /etc/init.d/varnish start
      program_stop  : /etc/init.d/varnish stop
    tests  :
      - type: connection
        host: 127.0.0.1
        port: 8080
        protocol: http
        protocol_test:
          request: /health.varnish
      - type      : cpu(user)
        operator  : ‘&gt;’
        value     : 60%
        tolerance :
          cycles  : 2
      - type      : children
        operator  : ‘&gt;’
        value     : 150</p>

<p>httpd :
    type   : service
    config :
      pidfile : /var/run/httpd/httpd.pid
      binary  : /usr/sbin/httpd
    tests  :
      - type: connection
        host: 127.0.0.1
        port: 80
        protocol: http</p>

<h1 id="notice-param-hostheader-changed-to-http-headers-in-monit-59">Notice: Param ‘HOSTHEADER’ changed to ‘HTTP HEADERS’ in monit 5.9</h1>
<p># see https://mmonit.com/monit/changes/
  http_headers :
    type: host
    config:
      address: 127.0.0.1
    tests:
      - type: connection
        host: 127.0.0.1
        port: 80
        protocol: http
        protocol_test:
          request: /
          status: 200
          http headers: ‘[host: www.example.com]’
        action: restart</p>

<p>custom-script :
    type   : program
    config :
      path   : /path/to/custom/pingcheck.sh
    tests  :
      - type      : status
        operator  : ‘!=’
        value     : 0
        tolerance :
          cycles  : 2
        action    : exec
        exec      : sudo /sbin/reboot
```</p>

<p>There’s a bunch of examples for configuring real services across Debian and
RedHat families in <a href="https://github.com/sbitio/puppet-ducktape">sbitio/ducktape</a> module.
Please refer to <a href="https://github.com/sbitio/puppet-ducktape/tree/master/manifests">manifests/*/external/monit.pp</a>
files.</p>

<h2 id="reference">Reference</h2>

<p>See Puppet Strings doc at <a href="https://github.com/sbitio/puppet-monit/blob/master/doc/index.html">doc/index.html</a></p>

<h2 id="limitations">Limitations</h2>

<p>This module requires Puppet 4.x, and is compatible with the following OSes/versions:</p>

<ul>
  <li>Debian 7, 8</li>
  <li>RedHat/CentOS 7,8</li>
  <li>Ubuntu 12.04, 14.04</li>
</ul>

<p>For Puppet 3 or older versions of Debian, please use 1.x.x releases.</p>

<h2 id="development">Development</h2>

<p>Development happens on <a href="https://github.com/sbitio/puppet-monit">GitHub</a>.</p>

<p>Please log issues for any bug report, feature or support request.</p>

<p>Pull requests are welcome.</p>

<h2 id="license">License</h2>

<p>MIT License, see LICENSE file</p>

<h2 id="contact">Contact</h2>

<p>Use contact form on http://sbit.io</p>
</div></div>

      <div id="footer">
     Generated by <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>.
</div>

    </div>
  </body>
</html>